

# 🌿 스마트팜 환경 구축 프로젝트 (2조)

**프로젝트 기간**: 2025.10.21 ~ 2025.10.29  
**주제**: IoT 기반 스마트팜 자동 제어 시스템 구축

---
**팀원 및 역할**
<img width="1542" height="467" alt="image" src="https://github.com/user-attachments/assets/227fa94c-6e81-480e-8917-e79ef868e701" />


---

## **프로젝트 기획서**

### **1. 프로젝트 개요**

- **프로젝트명**: 스마트팜 환경 구축  
- **목표**: 센서와 IoT 기술을 활용하여 작물의 생장 환경을 실시간으로 감지하고 자동으로 급수·조명·환기 제어가 가능한 시스템을 구축한다.

---

<img width="1202" height="1081" alt="image" src="https://github.com/user-attachments/assets/aad4753a-8490-4f6b-8eb5-c6428d2f19da" />


**필요한 기능**

- **콘솔**
  - 회원가입
  - 로그인
    - 아이디/패스워드 찾기
  - 로그아웃
  - 식물 추가
    - 프리셋 불러오기
    - 프리셋 설정
  - 식물 관리
    - 센서 데이터 목록 보기
    - 10시간 센서 데이터 그래프로 보기
    - 프리셋 수정하기
  - 마이페이지
    - 정보 조회
    - 정보 수정
    - 기기 추가
    - 기기 삭제
  - 알림 관리
    - 알림 확인
    - 알림 삭제
- **라즈베리파이**
  - 센서 제어 및 액추에이터 제어




---

### **2. 프로젝트 일정 (Gantt 차트 예시)**

| **작업 항목** | **시작 날짜** | **종료 날짜** | **기간(일)** |
| --- | --- | --- | --- |
| 세부 주제 및 자료 공유 방식 선정, DB, 콘솔 기능 구체화, 임무 분담 | 2025-10-21 | 2025-10-21 | 1 |
| DB 구현, 앱 디자인 | 2025-10-22 | 2025-10-22 | 1 |
| 자바 콘솔 기능 및 MQTT 구현 | 2025-10-23 | 2025-10-23 | 1 |
| 콘솔 기능 및 MQTT 구현 | 2025-10-24 | 2025-10-25 | 2 |
| 파이썬 MQTT 연동 및 센서 연결 개발 및 검토 | 2025-10-26 | 2025-10-27 | 2 |
| 프로토타입 제작 및 테스트, 오류 수정 | 2025-10-28 | 2025-10-28 | 1 |
| 최종 마무리 및 프로젝트 발표 | 2025-10-29 | 2025-10-29 | 1 |

---

## **작업 분할 구조 (WBS)**

### **1. 단계별 작업 구성**

#### **1. 기획**

1.1 프로젝트 목표 및 필요성 정의  
- IoT 기반 스마트팜 시스템 설계 — 센서 데이터 수집, 자동 제어, DB 저장 및 시각화 구현

1.2 전체 시스템 아키텍처 설계  
- Raspberry Pi(센서) ↔ MQTT Broker ↔ Java 서버 ↔ MySQL 구조 설계

1.3 데이터베이스 및 통신 토픽 구조 설계  
- `project_smartfarm` DB 스키마 및 MQTT Topic 정의

---

#### **2. 하드웨어 설계 및 구축**

2.1 센서 및 액추에이터 선정  
- DHT11(온습도), MH-Z19(CO₂), 조도 센서(LDR), 토양 수분 센서, 워터펌프, LED, 팬모터

2.2 라즈베리파이 GPIO 핀 구성 및 배선도 작성  
- MCP3008 ADC를 통한 아날로그 센서 연결, GPIO 기반 액추에이터 제어

2.3 개별 센서 테스트 코드 작성 (Python)  
- 각 센서별 정상 동작 확인 및 데이터 범위 측정

2.4 센서 통합 테스트  
- 라즈베리파이에서 모든 센서 동시 동작 및 MQTT 송신 확인

---

#### **3. 데이터 통신 및 저장 구조 구현**

3.1 MQTT 통신 구현 (Python → Java)  
- paho-mqtt 라이브러리를 이용하여 센서 데이터 Publish / Subscribe 구현

3.2 Java 서버 MQTT 수신 기능 구현  
- paho-mqtt + SensorDataServiceImpl로 메시지 파싱 및 DTO 변환

3.3 DB 저장 로직 구현 (DAO / JDBC)  
- sensor_logs 테이블에 실시간 데이터 저장

3.4 데이터 유효성 검사 및 예외 처리  
- 비정상 센서값 필터링, try-catch 예외 처리

---

#### **4. 제어 로직 구현**

4.1 자동 제어 로직 설계  
- 온도·습도·조도·수분 임계값 기반 LED, 펌프, 팬모터 자동 제어

4.2 Python 액추에이터 제어 코드 작성  
- GPIO 제어를 통한 LED, 펌프, 팬 작동 로직 구현

4.3 Java와 MQTT 연동을 통한 명령 송신 테스트  
- 서버에서 제어 명령을 MQTT Publish → Raspberry Pi Subscribe 후 동작 확인

4.4 전체 스마트팜 시나리오 통합  
- 센서 데이터 → 서버 저장 → 조건 충족 시 자동 제어 완성

---

#### **5. 테스트 및 검증**

5.1 센서 데이터 수집 테스트  
- 각 센서별 수집값 확인 및 범위 검증

5.2 MQTT 통신 안정성 테스트  
- 송수신 지연, 끊김 여부, 토픽별 구독 정상 동작 확인

5.3 DB 연동 검증  
- Java → MySQL 데이터 저장 및 조회 확인

5.4 자동 제어 및 예외 상황 검증  
- 센서 임계값 초과 시 LED/펌프 자동 제어 작동 확인

---

#### **6. 결과 및 발표**

6.1 시스템 구조도 정리  
6.2 프로젝트 결과 보고서 및 코드 정리  

- DAO / Service / DTO 구조 기반 코드 문서화

6.3 최종 시연 및 발표
  
- 실시간 센서 데이터 수집 → 자동 제어 동작 시연

---

## **요구사항 정의서**  

### **1. 기능 요구사항**

- [ ] 데이터 수집 기능: 라즈베리파이에 연결된 센서(DHT11, MH-Z19, 조도, 토양 수분 등)를 통해  
      온도·습도·CO₂·조도·토양 수분 데이터를 주기적으로 수집한다.
- [ ] 데이터 전송 기능: 수집된 센서 데이터를 MQTT 프로토콜을 이용해 브로커(Mosquitto)에 Publish 하고, Java 서버가 Subscribe 하여 수신한다.
- [ ] 데이터 전처리 기능: 수신된 데이터에서 결측값 및 비정상(이상치) 데이터를 필터링 후, 파싱 및 단위 변환을 수행한다.
- [ ] 데이터 저장 기능: 처리된 데이터를 DTO/DAO 구조를 통해 MySQL(sensor_logs 테이블)에 저장한다.
- [ ] 분석 기능: 저장된 센서 데이터를 시간대별로 조회하거나, 작물별 환경 조건(온도·습도 등)과 비교 분석할 수 있다.
- [ ] 시각화 기능: 콘솔 기반으로 실시간 데이터 로그 출력 및 DB 저장 로그 확인이 가능하다.
- [ ] 자동 제어 기능: 임계값(예: 수분 30% 이하 시 펌프 작동, 온도 30℃ 이상 시 팬 작동)을 기준으로 자동 제어를 수행한다.

---

### **2. 비기능 요구사항**

- [ ] 시스템 안정성: MQTT 통신 및 DB 연결 중 예외 발생 시 자동 복구 또는 재연결 로직 적용
- [ ] 성능: 실시간 수집 주기(기본 10초 단위) 내 데이터 처리 및 저장 완료
- [ ] 확장성: 다중 슬롯 구조 지원(farm_uid별 관리), 새로운 센서 추가 시 최소한의 코드 수정으로 반영 가능
- [ ] 유지보수성: DAO / Service / DTO 구조를 통한 계층 분리로 코드 수정 및 기능 확장 용이

---

## **프로젝트 설계서**

### **1. 시스템 아키텍처**

- **구성 요소:**
  - **센서 데이터 수집 모듈 (Raspberry Pi / Python)**  
    → 온습도, CO₂, 조도, 토양 수분 등 환경 데이터를 실시간으로 측정
  - **데이터 전송 및 통신 모듈 (MQTT)**  
    → 라즈베리파이에서 MQTT 프로토콜을 이용해 브로커로 데이터 전송
  - **데이터 수신 및 저장 모듈 (Java / JDBC)**  
    → Java 서버에서 MQTT 메시지를 Subscribe 받아 가공 후 MySQL DB에 저장
  - **데이터 분석 및 시각화 모듈 (Java 콘솔 기반)**  
    → 실시간 로그와 DB 저장 데이터를 기반으로 그래프 형태로 시각화 출력
  - **자동 제어 모듈 (Python Actuator Control)**  
    → 센서 값 기준으로 펌프, 팬, LED 등 액추에이터 자동 제어 수행

---

### **2. 데이터 설계**

- **데이터 흐름:**  
  센서 원본 데이터 → MQTT 전송 → Java 서버 수신 및 파싱 → MySQL 저장 → 콘솔 시각화 및 로그 분석  
- **주요 데이터 구조:**
 <img width="1730" height="1109" alt="image" src="https://github.com/user-attachments/assets/c01cf718-68c5-483f-bbf2-b25ab9b1b93f" />


---

### **3. 기술 스택**

- **하드웨어:** Raspberry Pi, DHT11, MH-Z19, 토양수분 센서, 조도 센서  
- **통신:** MQTT (Paho, Mosquitto)  
- **서버:** Java (Eclipse), JDBC  
- **DB:** MySQL (Workbench)  
- **시각화:** Java 콘솔 출력 (문자 그래프)  
- **버전 관리:** GitHub, Notion

---

### **4. 발생 문제 및 해결 방안**

- **문제:** GitHub 버전 관리 및 .gitignore 설정 등 초기 환경 설정 미숙
- **해결 방안:** Git 기본 개념 및 브랜치 관리 학습을 통해 협업 시 충돌 최소화 예정
- **문제:** 프로젝트 기획 경험 부족으로 인한 시행착오 다수 발생
- **해결 방안:** 이번 프로젝트에서의 어려움을 기반으로 다음 프로젝트에서는 명확한 기획과 일정 계획을 수립할 예정
- **문제:** CO₂ 감지 센서의 라이브러리 호환성 문제로 인한 센서 사용 어려움
- **해결 방안:** 센서 연동을 위해 다양한 라이브러리와 환경 설정을 시도했으나, 결국 최종 구현에는 포함하지 못함. 차후 프로젝트에서 이를 개선해 적용할 예정임.

---

## **시연 동영상**

- **링크:** https://photos.app.goo.gl/xVYaYiXoAKxWUxwy7
